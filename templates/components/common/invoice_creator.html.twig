<div {{ attributes }}>
    <form data-action="live#action" data-action-name="prevent|saveInvoice">
        <div class="mb-3">
            <label for="customer-name">Nom du client:</label>
            <input
                    type="text"
                    data-model="invoice.customerName"
                    class="form-control {{ _errors.has('invoice.customerName') ? 'is-invalid' }}"
                    id="customer-name"
            >
            {% if _errors.has('invoice.customerName') %}
                <div class="invalid-feedback">
                    {{ _errors.get('invoice.customerName') }}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="customer-email">E-mail de facturation:</label>
            <input
                    type="email"
                    data-model="invoice.customerEmail"
                    class="form-control {{ _errors.has('invoice.customerEmail') ? 'is-invalid' }}"
                    id="customer-email"
            >
            {% if _errors.has('invoice.customerEmail') %}
                <div class="invalid-feedback">
                    {{ _errors.get('invoice.customerEmail') }}
                </div>
            {% endif %}
        </div>
    </form>
        <div class="card">
            <div class="mt-6 mb-8 overflow-x-auto rounded-lg border-border-color border-border-width">
                <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:bg-dark-pr-blue">
                    <thead class="text-sm uppercase bg-bg-white dark:bg-dark-pr-blue dark:text-white-font border-b-border-width border-border-color">
                    <tr>
                        <th scope="col" class="px-6 py-3">Produit</th>
                        <th scope="col" class="px-6 py-3">Prix</th>
                        <th scope="col" class="px-6 py-3">Quantité</th>
                        <th scope="col" class="px-6 py-3">Remise</th>
                        
                    </tr>
                    </thead>
                    <tbody>
                    {% for key, line in lineItems %}
                        <twig:InvoiceCreatorLineItem
                                key="{{ key }}"
                                productId="{{ line.productId }}"
                                quantity="{{ line.quantity }}"
                                isEditing="{{ line.isEditing }}"
                        />
                    {% endfor %}
                    </tbody>
                </table>
                <twig:Button 
                    action="live#action"
                    actionName="addLineItem"
                    >
                    + Ajouter un produit
                </twig:Button>
            </div>
        </div>

        <div class="col-4 offset-8 mt-4">
            <table class="table text-end">
                <tbody>
                <tr>
                    <th>Sous total :</th>
                    <td>{{ this.subtotal|format_currency('USD') }}</td>
                </tr>
                <tr>
                    <th>TVA :</th>
                    <td class="d-flex justify-content-end">
                        <div style="width: 110px;"
                             class="input-group {{ _errors.has('invoice.taxes') ? 'is-invalid' }}">
                            <input
                                    type="number"
                                    data-model="invoice.taxes"
                                    class="form-control"
                            >
                            <span class="input-group-text">%</span>
                        </div>
                        {% if _errors.has('invoice.taxes') %}
                            <div class="invalid-feedback">
                                {{ _errors.get('invoice.taxes') }}
                            </div>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Total:</th>
                    <td>{{ this.total|format_currency('USD') }}</td>
                </tr>
                </tbody>
            </table>
        </div>

        <twig:Button content="Enregistrer la facture" path="/invoice" styles="mt-6" />
        {% if savedSuccessfully %}
            <small class="text-success">Facture enregistrée avec succès</small>
        {% endif %}
        {% if saveFailed %}
            Facture non enregistrée
        {% endif %}
        
        {% if saveFailed %}
            <small class="text-secondary">Vérifiez ci-dessus les erreurs</small>
        {% endif %}
        {% if areAnyLineItemsEditing %}
            <small class="text-secondary">Enregistrez toutes vos prestations avant de continuer.</small>
        {% endif %}
</div>



